<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Transform your emails into actionable insights with AI-powered analysis">
    <title>EmailWise - Intelligent Email Analysis</title>

    <!-- Bootstrap CSS with dark theme -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome for icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <!-- Google Fonts: Outfit for headings, Inter for body -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Outfit:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Custom CSS -->
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>

<body>
    <!-- Background Animation Layer -->
    <div class="bg-canvas">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
        <div class="grid-overlay"></div>
    </div>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg fixed-top glass-nav">
        <div class="container-xxl">
            <a class="navbar-brand d-flex align-items-center gap-2" href="#">
                <div class="brand-icon">
                    <i class="fas fa-brain text-white"></i>
                </div>
                <span class="fw-bold tracking-tight">Email<span class="text-gradient-primary">Wise</span></span>
            </a>
            <div class="d-flex align-items-center gap-3">
                <a href="https://github.com/Start-Impulse/EmailWise" target="_blank"
                    class="btn btn-sm btn-icon-only rounded-circle glass-btn-icon">
                    <i class="fab fa-github"></i>
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-wrapper">
        <div class="container-xxl py-5">
            <!-- Hero Section -->
            <section class="text-center mb-5 animate-enter">
                <div class="inline-badge mb-3 glass-badge">
                    <i class="fas fa-sparkles text-warning me-2"></i> AI-Powered Analysis v3.0
                </div>
                <h1 class="display-3 fw-bold mb-3 tracking-tighter">
                    Unlock the <span class="text-gradient-main">Power</span> of Your Inbox.
                </h1>
                <p class="lead text-muted mb-5 mx-auto" style="max-width: 600px;">
                    Instantly analyze threads, extract action items, and generate professional replies using advanced AI
                    including Gemini and OpenAI.
                </p>
            </section>

            <div class="row g-4 align-items-start">
                <!-- Left Input Panel -->
                <div class="col-lg-7 animate-enter delay-100">
                    <div class="glass-card main-panel position-relative overflow-hidden">

                        <!-- Panel Header -->
                        <div
                            class="panel-header p-4 border-bottom border-white border-opacity-10 d-flex justify-content-between align-items-center">
                            <h5 class="mb-0 fw-semibold"><i class="fas fa-pen-nib me-2 text-primary-light"></i>Input
                                Context</h5>
                            <div class="d-flex gap-2">
                                <button type="button" id="pasteBtn" class="btn btn-xs glass-btn-sm"
                                    title="Paste Clipboard">
                                    <i class="far fa-clipboard"></i> Paste
                                </button>
                                <button type="button" id="clearBtn" class="btn btn-xs glass-btn-sm text-danger-soft"
                                    title="Clear">
                                    <i class="fas fa-eraser"></i>
                                </button>
                            </div>
                        </div>

                        <div class="p-4">
                            <form id="emailForm">
                                <!-- Error Alert -->
                                <div id="errorAlert"
                                    class="alert glass-alert-danger d-none align-items-center justify-content-between fade mb-4"
                                    role="alert">
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-exclamation-circle me-3 fs-5"></i>
                                        <span id="errorMessage">An error occurred.</span>
                                    </div>
                                    <button type="button" class="btn-close btn-close-white" id="closeError"></button>
                                </div>

                                <!-- Text Input -->
                                <div class="mb-4 position-relative input-group-wrapper">
                                    <textarea id="emailContent" class="form-control glass-input custom-scrollbar"
                                        rows="10"
                                        placeholder="Paste your email thread or meeting notes here..."></textarea>
                                    <div class="char-counter">
                                        <span id="charCount">0</span> chars
                                    </div>
                                </div>

                                <!-- Controls Grid -->
                                <div class="settings-grid mb-4">
                                    <div class="setting-item">
                                        <label class="form-label">Summary Depth</label>
                                        <div class="select-wrapper">
                                            <select id="summaryStyle" class="form-select glass-select">
                                                <option value="detailed" selected>Detailed</option>
                                                <option value="quick">Concise</option>
                                                <option value="brief">Executive Brief</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="setting-item">
                                        <label class="form-label">Language</label>
                                        <div class="select-wrapper">
                                            <select id="outputLanguage" class="form-select glass-select">
                                                <option value="english" selected>English</option>
                                                <option value="spanish">Spanish</option>
                                                <option value="french">French</option>
                                                <option value="german">German</option>
                                                <option value="japanese">Japanese</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="setting-item">
                                        <label class="form-label">Response Tone</label>
                                        <div class="select-wrapper">
                                            <select id="replyTone" class="form-select glass-select">
                                                <option value="professional" selected>Professional</option>
                                                <option value="friendly">Friendly</option>
                                                <option value="strict">Direct</option>
                                                <option value="concise">Short</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <!-- File Upload & Action -->
                                <div
                                    class="action-bar d-flex flex-wrap justify-content-between align-items-center gap-3">
                                    <div class="file-upload-wrapper">
                                        <input type="file" id="attachmentInput" multiple class="d-none"
                                            accept=".pdf,.docx,.txt">
                                        <button type="button" id="uploadTrigger" class="btn glass-btn-secondary">
                                            <i class="fas fa-paperclip me-2"></i>Attached Files
                                            <span id="fileCountBadge"
                                                class="badge bg-white text-dark ms-2 rounded-pill d-none">0</span>
                                        </button>
                                        <div id="fileList" class="mt-2 text-xs text-muted"></div>
                                    </div>

                                    <button type="submit" id="analyzeBtn"
                                        class="btn btn-primary btn-glow btn-shimmer px-5 py-3">
                                        <span class="btn-text fw-bold"><i class="fas fa-bolt me-2"></i>Analyze
                                            Now</span>
                                        <span id="btnLoadingSpinner" class="d-none">
                                            <i class="fas fa-circle-notch fa-spin me-2"></i>Processing...
                                        </span>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- History Panel -->
                    <div class="glass-card mt-4 p-0 animate-enter delay-200 overflow-hidden">
                        <div
                            class="panel-header p-3 border-bottom border-white border-opacity-10 d-flex justify-content-between align-items-center bg-black bg-opacity-20">
                            <span class="text-xs text-uppercase fw-bold tracking-wide text-muted">Recent Analysis
                                history</span>
                            <div class="actions">
                                <button id="refreshHistoryBtn" class="btn btn-icon-only btn-xs text-muted"><i
                                        class="fas fa-sync-alt"></i></button>
                                <button id="clearHistoryBtn" class="btn btn-icon-only btn-xs text-danger-soft"><i
                                        class="fas fa-trash"></i></button>
                            </div>
                        </div>
                        <div id="historyContent" class="p-3 custom-scrollbar"
                            style="max-height: 200px; overflow-y: auto;">
                            <!-- History Items injected here -->
                        </div>
                    </div>
                </div>

                <!-- Right Results Panel -->
                <div class="col-lg-5 animate-enter delay-200">

                    <!-- Empty State -->
                    <div id="emptyState"
                        class="glass-card empty-panel h-100 d-flex flex-column align-items-center justify-content-center text-center p-5">
                        <div class="empty-icon-wrapper mb-4">
                            <i class="fas fa-microchip fa-3x text-gradient-primary"></i>
                        </div>
                        <h4 class="fw-semibold mb-2">Ready to Process</h4>
                        <p class="text-muted small max-w-xs">AI is standing by. Paste your content or upload documents
                            to receive instant insights.</p>

                        <div class="features-grid-mini mt-5">
                            <div class="feature-item">
                                <i class="fas fa-list-check text-success"></i>
                                <span>Action Items</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-reply text-info"></i>
                                <span>Smart Replies</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-shield-alt text-warning"></i>
                                <span>Risk Check</span>
                            </div>
                        </div>
                    </div>

                    <!-- Results Container -->
                    <div id="resultsSection" class="d-none d-flex flex-column gap-3">

                        <!-- High Level Metrics -->
                        <div class="glass-card p-3">
                            <div class="row g-2 text-center">
                                <div class="col-3 border-end border-white border-opacity-10">
                                    <div class="metric-label">Urgency</div>
                                    <div id="urgencyBadge" class="mt-1"></div>
                                </div>
                                <div class="col-3 border-end border-white border-opacity-10">
                                    <div class="metric-label">Sentiment</div>
                                    <div id="sentimentBadge" class="mt-1 d-flex justify-content-center"></div>
                                </div>
                                <div class="col-3 border-end border-white border-opacity-10">
                                    <div class="metric-label">Confidence</div>
                                    <div id="confidenceBadge" class="mt-1 fw-bold text-white"></div>
                                </div>
                                <div class="col-3">
                                    <div class="metric-label">Intent</div>
                                    <div id="intentBadge" class="mt-1 badge-soft"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Spam Alert -->
                        <div id="spamAlert" class="alert glass-alert-warning d-none">
                            <div class="d-flex gap-3">
                                <i class="fas fa-shield-virus fs-4"></i>
                                <div>
                                    <h6 class="alert-heading fw-bold mb-1">Potential Phishing/Spam</h6>
                                    <p class="mb-0 small opacity-75" id="spamReason"></p>
                                </div>
                            </div>
                        </div>

                        <!-- Main Tabs -->
                        <div class="glass-card overflow-hidden">
                            <ul class="nav nav-tabs nav-justified glass-tabs" id="resultTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="summary-tab" data-bs-toggle="tab"
                                        data-bs-target="#summary-pane" type="button">
                                        <i class="fas fa-file-alt me-2"></i>Summary
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="actions-tab" data-bs-toggle="tab"
                                        data-bs-target="#actions-pane" type="button">
                                        <i class="fas fa-check-square me-2"></i>Actions
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="replies-tab" data-bs-toggle="tab"
                                        data-bs-target="#replies-pane" type="button">
                                        <i class="fas fa-reply-all me-2"></i>Replies
                                    </button>
                                </li>
                            </ul>

                            <div class="tab-content p-4 custom-scrollbar" style="max-height: 500px; overflow-y: auto;">
                                <!-- Summary Pane -->
                                <div class="tab-pane fade show active" id="summary-pane" role="tabpanel">
                                    <div id="summaryContent" class="content-block"></div>
                                    <!-- Decision Helper Inline -->
                                    <div id="decisionCard"
                                        class="mt-4 pt-3 border-top border-white border-opacity-10 d-none">
                                        <h6 class="text-uppercase text-xs fw-bold text-muted mb-3">Strategic Analysis
                                        </h6>
                                        <div class="row g-2">
                                            <div class="col-6">
                                                <div class="decision-box success">
                                                    <span class="decision-icon"><i class="fas fa-plus"></i></span>
                                                    <ul id="prosList" class="list-unstyled mb-0 small"></ul>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="decision-box danger">
                                                    <span class="decision-icon"><i class="fas fa-minus"></i></span>
                                                    <ul id="consList" class="list-unstyled mb-0 small"></ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Actions Pane -->
                                <div class="tab-pane fade" id="actions-pane" role="tabpanel">
                                    <h6 class="text-xs text-uppercase text-primary-light mb-3">Detected Tasks</h6>
                                    <div id="actionItemsContent" class="task-list mb-4"></div>

                                    <h6 class="text-xs text-uppercase text-danger-soft mb-3">Important Deadlines</h6>
                                    <div id="deadlinesContent" class="deadline-list"></div>

                                    <!-- Quick Actions -->
                                    <div class="mt-4 pt-3 border-top border-white border-opacity-10">
                                        <div class="d-grid grid-cols-2 gap-2">
                                            <button class="btn btn-xs glass-btn-secondary w-100" data-action="archive">
                                                <i class="fas fa-archive me-2"></i>Archive
                                            </button>
                                            <button class="btn btn-xs glass-btn-secondary w-100" data-action="snooze">
                                                <i class="fas fa-clock me-2"></i>Snooze
                                            </button>
                                            <button class="btn btn-xs glass-btn-secondary w-100" data-action="delegate">
                                                <i class="fas fa-user-plus me-2"></i>Delegate
                                            </button>
                                            <button class="btn btn-xs glass-btn-secondary w-100"
                                                data-action="mark_read">
                                                <i class="fas fa-check-double me-2"></i>Read
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Replies Pane -->
                                <div class="tab-pane fade" id="replies-pane" role="tabpanel">
                                    <div
                                        class="d-flex justify-content-center bg-black bg-opacity-20 p-1 rounded-pill mb-3">
                                        <button class="btn btn-xs rounded-pill px-3 py-1 btn-toggle-reply active"
                                            data-target="#replyContent1">Option A</button>
                                        <button class="btn btn-xs rounded-pill px-3 py-1 btn-toggle-reply"
                                            data-target="#replyContent2">Option B</button>
                                    </div>

                                    <div id="replyContainer">
                                        <div id="replyContent1" class="reply-box active"></div>
                                        <div id="replyContent2" class="reply-box d-none"></div>
                                    </div>

                                    <button class="btn btn-primary w-100 mt-3" id="copyReplyBtn">
                                        <i class="far fa-copy me-2"></i>Copy to Clipboard
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Chat Widget -->
                        <div class="glass-card p-0">
                            <div class="chat-header p-3 bg-white bg-opacity-5 d-flex align-items-center gap-2">
                                <div
                                    class="avatar-xs bg-gradient-primary rounded-circle d-flex align-items-center justify-content-center">
                                    <i class="fas fa-robot text-xs text-white"></i>
                                </div>
                                <span class="fw-semibold small">Contextual Assistant</span>
                            </div>
                            <div id="chatHistory" class="p-3 custom-scrollbar" style="height: 150px; overflow-y: auto;">
                                <div class="text-center text-muted text-xs my-3">Ask questions about the analyzed
                                    email...</div>
                            </div>
                            <div class="p-2 border-top border-white border-opacity-10">
                                <div class="input-group">
                                    <input type="text" id="chatInput" class="form-control glass-input-sm border-0"
                                        placeholder="Type a question...">
                                    <button class="btn btn-sm btn-icon-only text-primary" id="chatSendBtn"><i
                                            class="fas fa-paper-plane"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="text-center py-4 text-muted text-xs opacity-50">
        <p>&copy; 2024 EmailWise. Powered by Gemini & OpenAI.</p>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script>
        // Inline UI Logic for Tab switching within Replies (micro-interactions)
        document.querySelectorAll('.btn-toggle-reply').forEach(btn => {
            btn.addEventListener('click', (e) => {
                // Remove active class from all buttons
                document.querySelectorAll('.btn-toggle-reply').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');

                // Hide all replies
                document.querySelectorAll('.reply-box').forEach(box => {
                    box.classList.add('d-none');
                    box.classList.remove('active');
                });

                // Show target
                const targetId = e.target.getAttribute('data-target');
                const target = document.querySelector(targetId);
                if (target) {
                    target.classList.remove('d-none');
                    target.classList.add('active');
                }
            });
        });

        // Copy active reply
        const copyReplyBtn = document.getElementById('copyReplyBtn');
        if (copyReplyBtn) {
            copyReplyBtn.addEventListener('click', () => {
                const activeReply = document.querySelector('.reply-box.active');
                if (activeReply) {
                    navigator.clipboard.writeText(activeReply.innerText);
                    const icon = copyReplyBtn.querySelector('i');
                    icon.className = 'fas fa-check me-2';
                    setTimeout(() => icon.className = 'far fa-copy me-2', 2000);
                }
            });
        }

        // Observer to toggle empty state
        const resultsNode = document.getElementById('resultsSection');
        const emptyState = document.getElementById('emptyState');
        if (resultsNode && emptyState) {
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (!resultsNode.classList.contains('d-none')) {
                        emptyState.classList.add('d-none');
                    } else {
                        emptyState.classList.remove('d-none');
                    }
                });
            });
            observer.observe(resultsNode, { attributes: true, attributeFilter: ['class'] });
        }
    </script>
</body>

</html>